<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Сторінка даних</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
          background-color: #f8f9fa;
        }

        .container {
          padding-top: 30px;
        }

        /* Покращення для форми */
        .form-label {
          font-weight: bold;
        }

        .form-select, .form-control {
          border-radius: 10px;
          box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
          transition: all 0.2s ease;
        }

        .form-select:focus, .form-control:focus {
          box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
          border-color: #007bff;
        }

        /* Стилі для карток */
        .card {
          border-radius: 15px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          background-color: #fff;
        }

        .card:hover {
          transform: translateY(-8px);
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .card-img-top {
          object-fit: cover;
          height: 200px;
          border-top-left-radius: 15px;
          border-top-right-radius: 15px;
        }

        .card-body {
          padding: 1.5rem;
        }

        .card-title {
          font-size: 1.1rem;
          font-weight: 600;
          color: #333;
        }

        .card-text {
          font-size: 0.9rem;
          color: #6c757d;
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
        }

        .btn-info {
          background-color: #17a2b8;
          border-color: #17a2b8;
        }

        .btn-info:hover {
          background-color: #138496;
          border-color: #117a8b;
        }

        /* Пагінація */
        .pagination a {
          color: #007bff;
          text-decoration: none;
          margin: 0 5px;
        }

        .pagination a:hover {
          color: #0056b3;
        }

        .pagination .active a {
          font-weight: bold;
          color: #fff;
          background-color: #007bff;
          border-color: #007bff;
        }

        /* Модальне вікно */
        .modal-content {
          border-radius: 15px;
        }

        .modal-header {
          background-color: #007bff;
          color: white;
        }

        .modal-footer button {
          border-radius: 10px;
        }
    </style>
</head>

<body>

<!-- Форма фільтрації -->
<form id="filterForm" action="#" method="get" class="mb-4">
    <div class="row">
        <!-- Вибір жанру -->
        <div class="col-md-2">
            <label for="genre" class="form-label">Оберіть жанр:</label>
            <select name="genre" id="genre" class="form-select" onchange="updateURL(1)">
                <option value="all" th:selected="${genre == 'all'}">Усі жанри</option>
                <option th:each="entry : ${genres}" th:value="${entry.key}" th:text="${entry.value}"
                        th:selected="${entry.key == genre}"></option>
            </select>
        </div>

        <!-- Пошук за назвою -->
        <div class="col-md-3">
            <label for="searchName" class="form-label">Пошук за назвою:</label>
            <input type="text" id="searchName" name="searchName" class="form-control" th:value="${searchName}"
                   placeholder="Введіть назву" oninput="updateURL(1)">
        </div>

        <!-- Вибір параметра сортування -->
        <div class="col-md-2">
            <label for="sortColumn" class="form-label">Сортування за:</label>
            <select name="sortColumn" id="sortColumn" class="form-select" onchange="updateURL(1)">
                <option value="name" th:selected="${sortColumn == 'name'}">Назва</option>
                <option value="date" th:selected="${sortColumn == 'date'}">Дата випуску</option>
                <option value="rating" th:selected="${sortColumn == 'rating'}">Рейтинг</option>
            </select>
        </div>

        <!-- Вибір кількості елементів на сторінці -->
        <div class="col-md-1">
            <label for="size" class="form-label">Кількість елементів на сторінці:</label>
            <select name="size" id="size" class="form-select" onchange="updateURL(1)">
                <option th:value="10" th:selected="${size == 10}">10</option>
                <option th:value="20" th:selected="${size == 20}">20</option>
                <option th:value="50" th:selected="${size == 50}">50</option>
            </select>
        </div>

        <div class="col-md-2">
            <label for="sortOrder" class="form-label">Порядок сортування:</label>
            <select name="sortOrder" id="sortOrder" class="form-select" onchange="updateURL(1)">
                <option value="asc" th:selected="${sortOrder == 'asc'}">За зростанням</option>
                <option value="desc" th:selected="${sortOrder == 'desc'}">За спаданням</option>
            </select>
        </div>
    </div>
</form>

<!-- Контейнер для карток -->
<div class="container">
    <div class="row card-columns">
        <div class="col-md-4 mb-4" th:each="dataset : ${movies}">
            <div class="card">
                <img th:src="${dataset.posterUrl}" class="card-img-top" alt="Image"
                     th:if="${dataset.posterUrl != null}">
                <div class="card-body">
                    <h5 class="card-title" th:text="${dataset.filmLabel}"></h5>
                    <p class="card-text" th:text="${dataset.description}"></p>
                    <button class="btn btn-info btn-sm" th:data-id="${dataset.id}" onclick="openModal(this)">
                        Детальніше
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Пагінація -->
<div class="d-flex justify-content-between align-items-center mt-4">
    <div>
        <p>Поточна сторінка: <span th:text="${page}">1</span></p>
        <p>Загальна кількість сторінок: <span th:text="${maxPages}">1</span></p>
    </div>
    <div>
        <a th:href="@{/?page={previousPage}&size={size}&genre={genre}&searchName={searchName}&sortColumn={sortColumn}&sort={sort}(previousPage=${previousPage}, size=${size}, genre=${genre}, searchName=${searchName}, sortColumn=${sortColumn}, sort=${sort})}"
           class="btn btn-primary btn-sm" th:if="${page > 1}">Попередня сторінка</a>
        <a th:href="@{/?page={nextPage}&size={size}&genre={genre}&searchName={searchName}&sortColumn={sortColumn}&sort={sort}(nextPage=${nextPage}, size=${size}, genre=${genre}, searchName=${searchName}, sortColumn=${sortColumn}, sort=${sort})}"
           class="btn btn-primary btn-sm" th:if="${page < maxPages}">Наступна сторінка</a>
    </div>
</div>

<!-- Модальне вікно -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Деталі</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрити"></button>
            </div>
            <div class="modal-body" id="detailsContent">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрити</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function openModal(button) {
      var filmId = button.getAttribute('data-id');  // Отримуємо id з атрибута data-id
      var myModal = new bootstrap.Modal(document.getElementById('detailsModal'));
      myModal.show();

      // Виконуємо AJAX-запит на сервер
      fetch('/' + filmId + '/details')
        .then(response => response.text())
        .then(data => {
          // Вставляємо отримані дані в модальне вікно
          document.getElementById('detailsContent').innerHTML = data;
        })
        .catch(error => console.error('Помилка:', error));
    }

    function updateURL(page) {
      const form = document.getElementById('filterForm');
      const urlParams = new URLSearchParams(window.location.search);

      // Збираємо параметри з форми
      const searchName = document.getElementById('searchName').value;
      const sortColumn = document.getElementById('sortColumn').value;
      const sortOrder = document.getElementById('sortOrder').value;
      const genre = document.getElementById('genre').value;
      const size = document.getElementById('size').value;

      urlParams.set('searchName', searchName);
      urlParams.set('sortColumn', sortColumn);
      urlParams.set('sortOrder', sortOrder);
      urlParams.set('genre', genre);
      urlParams.set('size', size);
      urlParams.set('page', page);

      // Додаємо або оновлюємо параметри
      window.location.search = urlParams.toString();
    }
</script>

</body>

</html>
